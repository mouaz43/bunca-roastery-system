<%
  var safeInventory = (typeof inventory !== "undefined" && inventory) ? inventory : null;
  var safeCoffees = (typeof coffees !== "undefined" && coffees) ? coffees : [];

  function safeUpdatedAt(){
    if (!safeInventory || !safeInventory.updatedAt) return "-";
    return String(safeInventory.updatedAt).slice(0,19).replace("T"," ");
  }
%>

<div class="card-grid">
  <div class="card">
    <h2>Lager Übersicht</h2>
    <p>Bestände pflegen, Engpässe verhindern. Änderungen werden über ein Formular übernommen.</p>
  </div>

  <div class="card">
    <h2>Letzte Änderung</h2>
    <p><strong><%= safeUpdatedAt() %></strong></p>
  </div>

  <div class="card">
    <h2>Schnellaktionen</h2>
    <p>Planung hängt am Lager. Erst Lager prüfen, dann Produktion planen.</p>
    <div style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap;">
      <a class="btn btn-secondary" href="/production">Zur Produktion</a>
      <a class="btn btn-ghost" href="/orders">Zu Bestellungen</a>
    </div>
  </div>

  <div class="card">
    <h2>Hinweis</h2>
    <p>In diesem Schritt speichern wir Änderungen im Dummy Store. Danach kommt Datenbank und Protokoll.</p>
  </div>
</div>

<div id="apply" style="margin-top:14px;" class="card card-wide">
  <h2>Bestand ändern</h2>
  <p>Wählen Sie Typ, Sorte und Änderung in kg (z.B. +10 oder -5). Danach wird der Bestand aktualisiert.</p>

  <form method="POST" action="/actions/inventory/apply">
    <div class="filterbar" style="margin-top:12px;">
      <div class="filter-left">
        <select class="select" name="type">
          <option value="GREEN">Typ: Rohkaffee</option>
          <option value="ROASTED">Typ: Röstkaffee</option>
        </select>

        <select class="select" name="coffeeId">
          <option value="">Sorte wählen</option>
          <% for (var i=0; i<safeCoffees.length; i++) { %>
            <option value="<%= safeCoffees[i].id %>"><%= safeCoffees[i].name %></option>
          <% } %>
        </select>

        <input class="input" name="deltaKg" placeholder="Menge in kg (z.B. +10 oder -5)" />
        <input class="input" name="note" placeholder="Grund (optional)" />
      </div>

      <div class="filter-right">
        <button class="btn btn-secondary" type="reset">Zurücksetzen</button>
        <button class="btn btn-primary" type="submit">Übernehmen</button>
      </div>
    </div>
  </form>

  <div style="margin-top:10px;" class="small-note">
    Später: Jede Änderung wird automatisch mit Zeit, Benutzer und Referenz gespeichert.
  </div>
</div>

<div style="margin-top:14px;" class="card card-wide">
  <h2>Bestandsübersicht</h2>
  <p>Diese Tabelle bleibt vorerst UI-only. Im nächsten Schritt zeigen wir echte Werte pro Sorte an.</p>
</div>
